<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="CPM.LIB.Search">
<Super>Base</Super>
<TimeCreated>63576,66371.397831</TimeCreated>

<Method name="Search">
<FormalSpec>String</FormalSpec>
<Implementation><![CDATA[
    set String=$zconvert($zstrip(String,"<>WC"),"U")
    do ..Registry.Cache.Update()
    
    set tST=##class(%SQL.Statement).%New()
    set tSC=tST.%PrepareClassQuery("CPM.Registry.Package","Search")
    $$$ThrowOnError(tSC)
    #dim tRes As %Library.ProcedureContext = tST.%Execute(String)
    while tRes.%Next() {
        set id=tRes.%Get("ID")
        set package=##class(CPM.Registry.Package).%OpenId(id)
        set authors=""
        for i=1:1:package.maintainers.Size {
            set $list(authors,i)="="_package.maintainers.GetAt(i)
        }
        set line=$listbuild(id,$listtostring(authors," "),$piece(package.modified," "),package.latestVersion,package.Description)
        set result($increment(result))=line
    }
    if $data(result) {
        set result(0)=$listbuild("NAME","AUTHOR","DATE","VERSION","DESCRIPTION")
    }
    do ..ShowTable(.result, String)
    quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
